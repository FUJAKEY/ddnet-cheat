dependencies:
  pre:
    - |
        sudo add-apt-repository -y ppa:zoogie/sdl2-snapshots
        sudo apt-get update
        sudo apt-get build-dep teeworlds
        sudo apt-get install libsdl2-dev cmake

        if [ ! -x ~/bam/bam ]; then
          git clone https://github.com/matricks/bam ~/bam/
          cd ~/bam; ./make_unix.sh
        fi

        if [ ! -x ~/ddnet-libs ]; then
          git clone https://github.com/ddnet/ddnet-libs ~/ddnet-libs/
        fi

  cache_directories:
    - "~/bam/"
    - "~/ddnet-libs/"

## Customize test commands
test:
  override:
    - |
        ln -s ~/ddnet-libs/ ddnet-libs
        cd ddnet-libs; git pull; cd ..
        ../bam/bam release

        mkdir build
        cd build
        env CFLAGS="-Wdeclaration-after-statement -Werror" CXXFLAGS="-Werror" cmake ..
        make everything
